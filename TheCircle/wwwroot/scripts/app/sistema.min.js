/*sistema v1.0 - Edgar Fernando Carvajal Ulloa efcarvaj@espol.edu.ec - Children International*/ angular.module("sistema", ["ui.router", "ngCookies"]).config(["$stateProvider", "$compileProvider", function (o, a) { o.state("activarusuario", { templateUrl: "views/sistema/activarusuario.html", controller: "activarusuario" }).state("desactivarusuario", { templateUrl: "views/sistema/desactivarusuario.html", controller: "desactivarusuario" }).state("cambiarclave", { templateUrl: "views/sistema/cambiarclave.html", controller: "cambiarclave" }) }]).run(["$state", "$rootScope", "$cookies", "$http", "refresh", function (o, a, s, e, t) { t.goTime(function () { e.get("login").then(function () { }, function (o) { 401 === o.status && (alert("Su sesion ha caducado"), document.location.replace("logout")) }) }, 12e5), a.session_name = function () { var o = s.get("session_name"); return o || "" }(), a.session_email = function () { var o = s.get("session_email"); return o || "" }(), a.session_photo = function () { var o = s.get("session_photo"); return o || "/images/ci.png" }(), o.go("activarusuario") }]).factory("refresh", [function () { return { go: function (o) { return o(), console.log("Go refresh"), setInterval(o, 1e4) }, stop: function (o) { console.log("Stop refresh"), clearInterval(o) }, goTime: function (o, a) { return o(), console.log("Go refresh by ", a), setInterval(o, a) } } }]).factory("notify", [function () { return function (o, a) { var s = ""; return "success" === a ? s = "glyphicon glyphicon-saved" : "danger" === a && (s = "glyphicon glyphicon-ban-circle"), $.notify({ icon: s, message: o, url: "#", target: "_blank" }, { element: "body", position: null, showProgressbar: !1, type: a, allow_dismiss: !0, newest_on_top: !1, placement: { from: "top", align: "right" }, offset: { x: 20, y: 70 }, spacing: 10, z_index: 1031, delay: 1e3, timer: 1e3, url_target: "_blank", mouse_over: "pause", animate: { enter: "animated bounceIn", exit: "animated bounceOut" }, onShow: null, onShown: null, onClose: null, onClosed: null, icon_type: "class" }) } }]).factory("usuarios", ["$http", "$rootScope", function (o, a) { var s = { inactivos: null, activos: null, all: null, getInactivos: function () { o.get("api/user/inactivos").then(function (o) { console.log("usuarios.inactivos", o.data), s.inactivos = o.data, a.$broadcast("usuarios.inactivos") }, function (o) { console.log("error cargar usuarios.inactivos", o) }) }, getActivos: function () { o.get("api/user/activos").then(function (o) { console.log("usuarios.activos", o.data), s.activos = o.data, a.$broadcast("usuarios.activos") }, function (o) { console.log("error cargar usuarios.activos", o) }) }, getAll: function () { o.get("api/user").then(function (o) { console.log("usuarios.all", o.data), s.all = o.data, a.$broadcast("usuarios.all") }, function (o) { console.log("error cargar usuarios.all", o) }) } }; return s }]).controller("activarusuario", ["$scope", "$state", "$http", "usuarios", "notify", function (o, a, s, e, t) { o.usuarios = e.inactivos, o.usuario = null, e.getInactivos(), o.$on("usuarios.inactivos", function () { o.usuarios = e.inactivos }), o.$watch("usuarios", function () { e.inactivos = o.usuarios }), o.seleccionar = function (a) { o.usuario = a }, o.aceptar = function () { $("#modal_activar").modal("hide"), NProgress.start(), s.put("api/user/" + o.usuario.cedula + "/activar").then(function (a) { console.log("Activado con exito"), o.usuarios = a.data, t("Usuario activado exitosamente", "success"), NProgress.done() }, function (o) { console.log("error al activar"), t("No se ha podido activar el usuario", "danger"), NProgress.done() }) } }]).controller("desactivarusuario", ["$scope", "$state", "$http", "usuarios", "notify", function (o, a, s, e, t) { o.usuarios = e.activos, o.usuario = null, e.getActivos(), o.$on("usuarios.activos", function () { o.usuarios = e.activos }), o.$watch("usuarios", function () { e.activos = o.usuarios }), o.seleccionar = function (a) { o.usuario = a }, o.aceptar = function () { $("#modal_desactivar").modal("hide"), NProgress.start(), s.put("api/user/" + o.usuario.cedula + "/desactivar").then(function (a) { console.log("desActivado con exito"), o.usuarios = a.data, t("No se ha podido activar el usuario", "success"), NProgress.done() }, function (o) { console.log("error al desactivar"), t("No se ha podido activar el usuario", "danger"), NProgress.done() }) } }]).controller("cambiarclave", ["$scope", "$state", "$http", "usuarios", function (o, a, s, e) { o.usuarios = e.all, o.usuario = null, o.clave = null, e.getAll(), o.$on("usuarios.all", function () { o.usuarios = e.all }), o.seleccionar = function (a) { o.usuario = a }, o.aceptar = function () { $("#cambiar_clave").modal("hide"), NProgress.start(), s.put("api/user/" + o.usuario.cedula + "/clave/set").then(function (a) { NProgress.done(), console.log("Cambio de clave exitoso", a.data), o.clave = a.data.clave, $("#nueva_clave").modal("show"), notify("Reseteo de clave exitoso", "success") }, function (o) { console.log("error cambio de clave"), NProgress.done(), notify("No se ha podido cambiar la clave del usuario", "danger") }) } }]);