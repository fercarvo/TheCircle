/*
    sistema v1.0 
    Edgar Fernando Carvajal Ulloa efcarvaj@espol.edu.ec
    Children International
*/
angular.module("sistema",["ui.router","ngCookies"]).config(["$stateProvider","$compileProvider",function(o,a){o.state("activarusuario",{templateUrl:"views/sistema/activarusuario.html",controller:"activarusuario"}).state("desactivarusuario",{templateUrl:"views/sistema/desactivarusuario.html",controller:"desactivarusuario"}).state("cambiarclave",{templateUrl:"views/sistema/cambiarclave.html",controller:"cambiarclave"}),a.debugInfoEnabled(false)}]).run(["$state","$rootScope","$cookies","$http","refresh",function(o,a,t,s,e){e.goTime(function(){s.get("login").then(function(){},function(o){401===o.status&&(alert("Su sesion ha caducado"),document.location.replace("logout"))})},12e5),a.session_name=function(){var o=t.get("session_name");return o||""}(),a.session_email=function(){var o=t.get("session_email");return o||""}(),a.session_photo=function(){var o=t.get("session_photo");return o||"/images/ci.png"}(),o.go("activarusuario")}]).factory("refresh",[function(){return{go:function(o){return o(),setInterval(o,1e4)},stop:function(o){clearInterval(o)},goTime:function(o,a){return o(),setInterval(o,a)}}}]).factory("notify",[function(){return function(o,a){var t="";return"success"===a?t="glyphicon glyphicon-saved":"danger"===a&&(t="glyphicon glyphicon-ban-circle"),$.notify({icon:t,message:o,url:"#",target:"_blank"},{element:"body",position:null,showProgressbar:!1,type:a,allow_dismiss:!0,newest_on_top:!1,placement:{from:"top",align:"right"},offset:{x:20,y:70},spacing:10,z_index:1031,delay:1e3,timer:1e3,url_target:"_blank",mouse_over:"pause",animate:{enter:"animated bounceIn",exit:"animated bounceOut"},onShow:null,onShown:null,onClose:null,onClosed:null,icon_type:"class"})}}]).factory("usuarios",["$http","$rootScope",function(o,a){var t={inactivos:null,activos:null,all:null,getInactivos:function(){o.get("api/user/inactivos").then(function(o){t.inactivos=o.data,a.$broadcast("usuarios.inactivos")},function(o){})},getActivos:function(){o.get("api/user/activos").then(function(o){t.activos=o.data,a.$broadcast("usuarios.activos")},function(o){})},getAll:function(){o.get("api/user").then(function(o){t.all=o.data,a.$broadcast("usuarios.all")},function(o){})}};return t}]).controller("activarusuario",["$scope","$state","$http","usuarios","notify",function(o,a,t,s,e){o.usuarios=s.inactivos,o.usuario=null,s.getInactivos(),o.$on("usuarios.inactivos",function(){o.usuarios=s.inactivos}),o.$watch("usuarios",function(){s.inactivos=o.usuarios}),o.seleccionar=function(a){o.usuario=a},o.aceptar=function(){$("#modal_activar").modal("hide"),NProgress.start(),t.put("api/user/"+o.usuario.cedula+"/activar").then(function(a){o.usuarios=a.data,e("Usuario activado exitosamente","success"),NProgress.done()},function(o){e("No se ha podido activar el usuario","danger"),NProgress.done()})}}]).controller("desactivarusuario",["$scope","$state","$http","usuarios","notify",function(o,a,t,s,e){o.usuarios=s.activos,o.usuario=null,s.getActivos(),o.$on("usuarios.activos",function(){o.usuarios=s.activos}),o.$watch("usuarios",function(){s.activos=o.usuarios}),o.seleccionar=function(a){o.usuario=a},o.aceptar=function(){$("#modal_desactivar").modal("hide"),NProgress.start(),t.put("api/user/"+o.usuario.cedula+"/desactivar").then(function(a){o.usuarios=a.data,e("No se ha podido activar el usuario","success"),NProgress.done()},function(o){e("No se ha podido activar el usuario","danger"),NProgress.done()})}}]).controller("cambiarclave",["$scope","$state","$http","usuarios","notify",function(o,a,t,s,e){o.usuarios=s.all,o.usuario=null,o.clave=null,s.getAll(),o.$on("usuarios.all",function(){o.usuarios=s.all}),o.seleccionar=function(a){o.usuario=a},o.aceptar=function(){$("#cambiar_clave").modal("hide"),NProgress.start(),t.put("api/user/"+o.usuario.cedula+"/clave/set").then(function(a){NProgress.done(),o.clave=a.data.clave,$("#nueva_clave").modal("show"),e("Reseteo de clave exitoso","success")},function(o){NProgress.done(),e("No se ha podido cambiar la clave del usuario","danger")})}}]);