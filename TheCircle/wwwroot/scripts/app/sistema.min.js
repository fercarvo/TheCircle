/*
    sistema v1.0 
    Edgar Fernando Carvajal Ulloa efcarvaj@espol.edu.ec
    Children International
*/
angular.module("sistema",["ui.router"]).config(["$stateProvider","$compileProvider",function(a,o){a.state("activarusuario",{templateUrl:"views/sistema/activarusuario.html",controller:"activarusuario"}).state("desactivarusuario",{templateUrl:"views/sistema/desactivarusuario.html",controller:"desactivarusuario"}).state("cambiarclave",{templateUrl:"views/sistema/cambiarclave.html",controller:"cambiarclave"}),o.debugInfoEnabled(!1),o.commentDirectivesEnabled(!1),o.cssClassDirectivesEnabled(!1)}]).run(["$state","$http","$templateCache",function(a,o,s){checkSession(o),loadTemplates(a,"activarusuario",o,s)}]).factory("usuarios",["$http","$rootScope",function(a,o){function s(){a.get("api/user/inactivos").then(function(a){console.log("usuarios.inactivos",a.data),e.inactivos=a.data,o.$broadcast("usuarios.inactivos")},function(a){console.log("error cargar usuarios.inactivos",a)})}function i(){a.get("api/user/activos").then(function(a){console.log("usuarios.activos",a.data),e.activos=a.data,o.$broadcast("usuarios.activos")},function(a){console.log("error cargar usuarios.activos",a)})}function t(){a.get("api/user").then(function(a){console.log("usuarios.all",a.data),e.all=a.data,o.$broadcast("usuarios.all")},function(a){console.log("error cargar usuarios.all",a)})}var e={inactivos:null,activos:null,all:null,getInactivos:s,getActivos:i,getAll:t};return e}]).controller("activarusuario",["$scope","$state","$http","usuarios",function(a,o,s,i){a.usuarios=i.inactivos,a.usuario=null,i.getInactivos(),a.$on("usuarios.inactivos",function(){a.usuarios=i.inactivos}),a.$watch("usuarios",function(){i.inactivos=a.usuarios}),a.seleccionar=function(o){a.usuario=o},a.aceptar=function(){$("#modal_activar").modal("hide"),NProgress.start(),s.put("api/user/"+a.usuario.cedula+"/activar").then(function(o){console.log("Activado con exito"),a.usuarios=o.data,notify("Usuario activado exitosamente","success"),NProgress.done()},function(a){console.log("error al activar"),notify("No se ha podido activar el usuario","danger"),NProgress.done()})}}]).controller("desactivarusuario",["$scope","$state","$http","usuarios",function(a,o,s,i){a.usuarios=i.activos,a.usuario=null,i.getActivos(),a.$on("usuarios.activos",function(){a.usuarios=i.activos}),a.$watch("usuarios",function(){i.activos=a.usuarios}),a.seleccionar=function(o){a.usuario=o},a.aceptar=function(){$("#modal_desactivar").modal("hide"),NProgress.start(),s.put("api/user/"+a.usuario.cedula+"/desactivar").then(function(o){console.log("desActivado con exito"),a.usuarios=o.data,notify("Se ha bloqueado al usuario satisfactoriamente","success"),NProgress.done()},function(a){console.log("error al desactivar"),notify("No se ha podido activar el usuario","danger"),NProgress.done()})}}]).controller("cambiarclave",["$scope","$state","$http","usuarios",function(a,o,s,i){a.usuarios=i.all,a.usuario=null,a.clave=null,i.getAll(),a.$on("usuarios.all",function(){a.usuarios=i.all}),a.seleccionar=function(o){a.usuario=o},a.aceptar=function(){$("#cambiar_clave").modal("hide"),NProgress.start(),s.put("api/user/"+a.usuario.cedula+"/clave/set").then(function(o){NProgress.done(),console.log("Cambio de clave exitoso",o.data),a.clave=o.data.clave,$("#nueva_clave").modal("show"),notify("Reseteo de clave exitoso","success")},function(a){console.log("error cambio de clave"),NProgress.done(),notify("No se ha podido cambiar la clave del usuario","danger")})}}]);